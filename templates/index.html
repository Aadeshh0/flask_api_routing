{% extends "base.html"%}

{% block head %}
<title>Task Master</title>
{% endblock %}

{% block body%} 
<div class="content">
    <h1 style="text-align: center;">Task Master</h1>
    <p style="text-align: center;">Your simple, modern to-do manager.</p>

    <div style="text-align: center; margin-bottom: 1rem;">
        <input 
            type="text" 
            id="searchInput" 
            placeholder="Search tasks..." 
            style="width: 60%; padding: 10px; font-size: 1em; border: 1px solid #ccc; border-radius: 10px;"
        >
    </div>
    {% if tasks|length < 1 %}
    <h4 style="text-align: center;">No tasks available. Add a task below.</h4>
    {% else %}
    <table>
        <tr>
            <th>Done</th>
            <th>Task</th>
            <th>Added</th>
            <th>Actions</th>
        </tr>
        {% for task in tasks %}
            <tr>
                <td>
                    <form action="/toggle/{{task.id}}" method="GET">
                        <input type="checkbox" onchange="this.form.submit()" {% if task.is_done %}checked{% endif %}>
                    </form>
                </td>
                <td class="{% if task.is_done %}completed{% endif %}">{{ task.content }}</td>
                <td>{{ task.date_created.date() }}</td>
                <td>
                    <a href="/update/{{task.id}}">‚úèÔ∏è Edit</a>
                    <br>
                    <a href="/delete/{{task.id}}">üóë Delete</a>
                </td>
            </tr>
        {% endfor %}
    </table>
    {% endif %}

    <form action="/" method="POST">
        <input type="text" name="content" id="content" placeholder="Enter a new task..." required>
        <input type="submit" value="Add Task">
    </form>

    <p style="text-align: left; color: gray; font-size: 0.9em; margin-top: 12px;" >
        Press <strong>Shift</strong> & <strong>+</strong> to quickly add a new task
    </p>
        
</div>

<script>
    document.addEventListener('keydown', function (event) {
        // Check if Shift and '+' are pressed together
        if (event.shiftKey && event.key === '+') {
            const input = document.getElementById('content');
            
            // Only trigger if the user is NOT currently typing in another field
            if (document.activeElement === document.body || document.activeElement.tagName === 'TABLE') {
                event.preventDefault(); // prevent accidental zoom or other action
                input.focus();
            }
        }
    });

    const searchInput = document.getElementById('searchInput');
    let debounceTimer;
    
    searchInput.addEventListener('input', function () {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => {
        const filter = (searchInput.value || '').toLowerCase();
    
        // Select all rows but skip the header row if present
        const rows = Array.from(document.querySelectorAll('table tr')).filter(r => r.querySelectorAll('td').length > 0);
    
        let visibleCount = 0;
        rows.forEach(row => {
          // Try to find the task text robustly:
          let taskCell = row.querySelector('.task-content')          // preferred if you add class
                      || row.querySelector('td:nth-child(2)')       // second column (if you have checkbox first)
                      || row.querySelector('td:nth-child(1)')       // first column fallback
                      || row.querySelector('td');                   // final fallback
    
          const taskText = taskCell ? (taskCell.innerText || '').toLowerCase() : '';
    
          if (taskText.includes(filter)) {
            row.style.display = '';
            visibleCount++;
          } else {
            row.style.display = 'none';
          }
        });
    
        // Manage "No tasks found" message
        let tableBody = document.querySelector('table');
        let noTasksMsg = document.getElementById('noTasksMsg');
        if (!noTasksMsg) {
          noTasksMsg = document.createElement('tr');
          noTasksMsg.id = 'noTasksMsg';
          noTasksMsg.innerHTML = `<td colspan="4" style="text-align:center; color: gray;">No tasks found</td>`;
          tableBody.appendChild(noTasksMsg);
        }
        noTasksMsg.style.display = visibleCount === 0 ? '' : 'none';
      }, 150);
    });
</script>

    
    
{% endblock%}
